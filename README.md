# Инструкция по развертыванию фронтенда для приложения хранения файлов Megadisk

Примеры в инструкции будут написаны для Ubuntu, предустановленную на платформе reg.ru. Но, по образу и подобию, вы можете развернуть данный продукт на других линуксоподобных ОС.

## Обновление информации о пакетах ОС

Перед установкой программного обеспечени необходимо обновить информацию о пакетах операционной системы, чтобы установить актуальные версии программ

#### Пример для Ubuntu v22 reg.ru

Если вы ставите фронтенд на тот же сервер, где уже стоит бекенд, операцию можно пропустить

```
apt update
``` 

## Установка программ

Для работы бекенда нужно установить следующее ПО:
1. Git
2. Npm
3. Nginx

#### Пример для Ubuntu v22 reg.ru

На данной операционной системе уже установлен Git нормальной версии

Если вы ставите фронтенд на тот же сервер, где уже стоит бекенд, установку nginx можно пропустить

Устанавливаем остальное ПО

```
apt install npm nginx
```

Тут возникает проблема. Возможно на других ОС ее нет. Вместе с npm ставится NodeJS 12-ой версии. А нам нужна минимум 18-я.

Удаляем NodeJS

```
apt remove nodejs
```

Чистим ненужные пакеты

```
apt autoremove
```

Ставим 18-ю версию с сайта

```
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - && sudo apt-get install -y nodejs
```

## Создаем папку для проекта

Нужно создать папку для проекта и перейти в нее

#### Пример для Ubuntu v22 reg.ru

```
mkdir /home/frontend
cd /home/frontend/
```

## Скачиваем бекенд из репозитория и переходим в папку проекта

Скачиваем код бекенда с github.com. После скачивания необходимо перейти в папку проекта

#### Пример для Ubuntu v22 reg.ru

```
git clone https://github.com/babka40000/diplom-frontend.git
cd diplom-frontend
```

## Устанавливаем зависимости

Нужно переустановить все нужные модули nodejs

```
npm install
```

## Прописываем переменные окружения


Нам нужно создать файл .env и прописать переменные окружения для текущего сервера. В папке лежит файл .env.example, в котором прописаны все поля со сначеними для примера. Нужно скопировать этот файл в .env и изменить значения в нем на нужные нам.

```
cp .env.example .env
nano .env
```

После редактировани параметров сохраняемся и выходим из редактора.

## Сборка проекта

Собираем проект с помощью команды build

```
npm run build
```

## Настройка nginx

nginx - веб сервер, который обрабатывает запросы вашего браузера. Потом он их должен по цепочке отправлять в gunicorn. Также нужно указать веб-серверу папку со статикой.

Делаем файл с настройками и открываем его в редакторе

```
touch /etc/nginx/sites-available/megadisk_frontend
nano /etc/nginx/sites-available/megadisk_frontend
```

Копируем в файл следующую конфигурацию:

```
server {
  listen 80;
  server_name 89.104.68.233;

  location / {
    root  /home/frontend/diplom-frontend/build;
  }
}
```

Сохраняемся и выходим

Включаем нашу настройку в конфигурацию nginx

```
ln -s /etc/nginx/sites-available/megadisk_frontend /etc/nginx/sites-enabled/
```

Перезапускаем nginx

```
service nginx restart
```

Открываем порты фаервола для nginx

```
ufw allow 'Nginx Full'
```

На этом настройка фронтенда завершена.